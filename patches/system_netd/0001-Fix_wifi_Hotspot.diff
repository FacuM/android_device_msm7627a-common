From 9ad89ad5c517e6f13b9834651d19177c340f8d56 Mon Sep 17 00:00:00 2001
From: weritos6666 <weritos94@gmail.com>
Date: Fri, 4 Mar 2016 14:15:34 +0500
Subject: [PATCH] Fix_wifi_Hotspot

---
 server/SoftapController.cpp | 26 ++++----------------------
 1 file changed, 4 insertions(+), 22 deletions(-)

diff --git a/server/SoftapController.cpp b/server/SoftapController.cpp
index 27ed684..9793248 100755
--- a/server/SoftapController.cpp
+++ b/server/SoftapController.cpp
@@ -60,7 +60,7 @@ static const char HOSTAPD_DHCP_DIR[]    = "/data/misc/dhcp";
 static const char HOSTAPD_CONF_FILE[]    = "/data/misc/wifi/hostapd.conf";
 static const char HOSTAPD_BIN_FILE[]    = "/system/bin/hostapd";
 static const char HOSTAPD_SOCKETS_DIR[]    = "/data/misc/wifi/sockets";
-static const char WIFI_HOSTAPD_GLOBAL_CTRL_IFACE[] = "/data/misc/wifi/hostapd/global";
+/*static const char WIFI_HOSTAPD_GLOBAL_CTRL_IFACE[] = "/data/misc/wifi/hostapd/global";*/
 
 SoftapController::SoftapController()
     : mPid(0) {}
@@ -155,35 +155,17 @@ void *SoftapController::threadStart(void *obj){
 int SoftapController::startSoftap(bool global_ctrl_iface, SocketClient *socketClient = NULL) {
     pid_t pid = 1;
     DIR *dir = NULL;
-    int ret;
 
     if (mPid) {
         ALOGE("SoftAP is already running");
         return ResponseCode::SoftapStatusResult;
     }
 
-    if (ensure_entropy_file_exists() < 0) {
-        ALOGE("Wi-Fi entropy file was not created");
-    }
-
-    if ((pid = fork()) < 0) {
-        ALOGE("fork failed (%s)", strerror(errno));
-        return ResponseCode::ServiceStartFailed;
-    }
-
     if (!pid) {
         ensure_entropy_file_exists();
-        if (global_ctrl_iface) {
-            ret = execl(HOSTAPD_BIN_FILE, HOSTAPD_BIN_FILE,
-                        "-e", WIFI_ENTROPY_FILE, "-ddd",
-                        "-g", WIFI_HOSTAPD_GLOBAL_CTRL_IFACE,
-                        HOSTAPD_CONF_FILE, (char *)NULL);
-        } else {
-            ret = execl(HOSTAPD_BIN_FILE, HOSTAPD_BIN_FILE,
-                        "-e", WIFI_ENTROPY_FILE, HOSTAPD_CONF_FILE,
-                        (char *)NULL);
-        }
-        if (ret) {
+        if (execl(HOSTAPD_BIN_FILE, HOSTAPD_BIN_FILE,
+                  "-e", WIFI_ENTROPY_FILE,
+                  HOSTAPD_CONF_FILE, (char *) NULL)) {
             ALOGE("execl failed (%s)", strerror(errno));
         }
         ALOGE("SoftAP failed to start");
-- 
2.10.1

